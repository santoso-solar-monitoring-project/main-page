{"version":3,"sources":["utils/Imm/withImm.ts","utils/warn.ts","utils/ignore.ts","utils/DefaultProps.ts","components/GoodCanvas/GoodCanvasElement.ts","components/GoodCanvas/GoodCanvasChild.ts","utils/isValidRefObject.ts","utils/canvas/getContext.ts","utils/canvas/isValidGoodCanvas.ts","utils/canvas/enhanceContext.ts","utils/noop.ts","utils/CustomHooks/useMemoRef.ts","utils/CustomHooks/useThrottled.ts","utils/CustomHooks/useDataBufferSilent.ts","utils/CustomHooks/useDecay.ts","utils/Imm/useImm.ts","utils/Imm/makeImmHook.ts","utils/canvas/newEffect.ts","utils/canvas/clear.ts","utils/throttleEvent.ts","utils/BaseProps.ts","components/Blur/index.tsx","components/GoodCanvas/index.tsx","utils/canvas/scaleCanvas.ts","utils/propagateProps.tsx","components/usePoints/index.tsx","components/useLine/index.tsx","utils/evaluate.ts","components/IVPlot/useDataFeed.ts","utils/clamp.ts","components/IVPlot/useView.ts","components/IVPlot/useDash.ts","components/IVPlot/useFPS.ts","components/IVPlot/useScales.ts","components/IVPlot/useTimespan.ts","components/IVPlot/useAnimationFrame.ts","utils/CustomHooks/useSilentCounter.ts","utils/CustomHooks/useCounter.ts","components/IVPlot/useCrop.ts","utils/identity.ts","utils/diff.ts","components/IVPlot/useControls.ts","components/Glow/index.tsx","components/IVPlot/_IVPlot.tsx","components/IVPlot/usePaddingSpring.ts","components/IVPlot/index.tsx","App.tsx","serviceWorker.js","index.tsx"],"names":["ignoreUndefined","old","next","undefined","defaultMerger","_old","mergeIntersect","target","_len","arguments","length","sources","Array","_key","mergeIntersectWith","apply","concat","merger","_len2","_key2","selection","Object","keys","filter","Boolean","map","source","key","includes","reduce","obj","objectSpread","defineProperty","mergeWith","toConsumableArray","merge","_len3","_key3","_len4","_key4","_mergeDeepWith","toJS","isMergeable","a","List","isList","_len5","collections","_key5","slice","acc","x","_mergeDeep","b","nextItem","index","existingItem","get","set","fromJS","_len6","_key6","aaaaa","hello","canvasStyle","canvasEffects","bbbbb","poop","process","declare","propsClass","baseClasses","defaults","withImm","base","forEach","warn","factory","props","allOptional","some","c","Wrap","classCallCheck","this","createClass","value","f","placeholder","rest","default","decorator","optional","types","required","injected","propsIn","propsOut","own","bases","wrap","extend","assign","_class","_temp","_class2","_temp2","values","reverse","_class3","_temp3","GoodCanvasElement","dims","width","height","setNeedsUpdate","Error","Props","isValidRefObject","ref","errors","REF_NULL","NO_CURRENT","cache","Map","getContext","canvasRef","current","isValidGoodCanvas","cached","canvas","ctx","result","enhanceContext","createMatrix","document","createElementNS","getCTM","context","currentTransform","enhanced","savedTransforms","_setMatrix","m","setTransform","d","e","save","push","restore","pop","scale","y","scaleNonUniform","rotate","theta","Math","PI","translate","transform","rhs","multiply","resetTransform","isolate","call","args","deriveCoordinate","coord","_coord$width","w","_coord$height","h","deriveCoordinates","_ref","_ref$x","_ref$y","Proxy","noop","useMemoRef","initialValue","useMemo","useRef","timeout","first","last","useThrottled","inputs","useEffect","_withImm$merge","event","id","ongoing","handler","clearTimeout","window","setTimeout","addEventListener","removeEventListener","maxSize","Infinity","Args","minDelta","maxDelta","halfLife","UpdateArgs","useDecay","signal","_ref2","datum","delta","decay","pow","isNaN","useImm","hook","arg","savedInputs","makeImmHook","EffectOptions","style","injectEffect","Options","injection","newEffect","effect","options","_Options","effectChain","children","render","execute","Resolver","isEnhancedContext","CanvasRenderingContext2D","clear","clearRect","defaultArgs","_window","throttle","customEvent","ready","dispatcher","dispatchEvent","CustomEvent","throttler","requestAnimationFrame","passive","StyleProp","BaseProps","radius","enabled","Blur","_useSpring","useSpring","from","config","duration","_useSpring2","slicedToArray","update","hidden","react_default","createElement","web","div","React","forwardRef","GoodCanvas_temp","GoodCanvas_class","position","overflow","boxSizing","notify","_useState","useState","_useState2","needsUpdate","containerRef","firstRender","blur","useLayoutEffect","container","_getContext","computeStyle","property","parseFloat","getComputedStyle","getPropertyValue","getTotalOffset","direction","t","performance","now","dpr","devicePixelRatio","savedWidth","savedHeight","ceil","beginPath","rect","clip","scaleCanvas","toFixed","i","decoratedChildren","propagateProps","Fragment","Children","child","isValidElement","cloneElement","_child","canvasNeedsUpdate","components_Blur","left","top","margin","padding","border","usePoints","fillStyle","strokeStyle","lineWidth","data","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","done","_ref4","_ref3","arc","fill","stroke","err","return","objectWithoutProperties","useLine","line","effectOptions","theLine","expr","Function","k","evaluate","d3","useDataFeed","samplePeriod","_useDataBufferSilent","buffer","Denque","updateBuffer","useCallback","newData","splice","useDataBufferSilent","_useDataBufferSilent2","receiveData","generate","random","CURRENT","min","max","lo","hi","Date","clamp","v","range","_withImm$mergeInterse","_withImm$mergeInterse2","useView","extraHistory","scaleX","scaleY","extent","tension","friction","currentScaleX","copy","bisector","transformed","domain","by","_currentScaleX$domain","_currentScaleX$domain2","start","end","timespan","history","right","padRight","padLeft","unpadRight","immediate","view","hist","useDash","period","segments","total","offset","setLineDash","lineDashOffset","useFPS","font","updateDecay","slow","decayed","fps","text","textWidth","measureText","_ctx$deriveCoordinate","_ctx$deriveCoordinate2","offsetX","offsetY","fillText","useScalesXY","GoodCanvasChild","_useMemo","_useMemo2","_canvas$dims","padX","padY","useTimespan","speed","useAnimationFrame","_ref$silent","silent","_ref$interval","interval","firstTime","console","error","initial","increment","useSilentCounter","setValue","useCounter","nextFrame","loop","cancelAnimationFrame","setInterval","clearInterval","useClip","invert","clipBy","region","Path2D","identity","diff","convert","slope","s","useControls","baseScale","zoomedScale","zoom","scaleExtent","translateExtent","_playPause","clientX","clientY","lastClicked","playing","at","moonWalk","dx","isFinite","translateBy","onStart","sourceEvent","MouseEvent","TouchEvent","onEnd","dispatch","playPause","on","rescaleX","transition","useGlow","spread","color","_ctx$lineWidth","existing","_IVPlot","amps","volts","_useScalesXY","_useScalesXY2","_useScalesXY3","scaleY2","_useControls","_useControls2","updateZoomedScale","springProps","usePaddingSpring","_useView","ampsView","updateAmpsView","_useView2","voltsView","updateVoltsView","viewScale","useTicks","format","tickFormat","span","getTime","every","ticks","gap","pad","tick","moveTo","lineTo","useLabels","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_ref5","dashed","inside","outside","glow1","glow2","glowLine","points","line2","glowLine2","points2","animations","borderRadius","backgroundColor","components_GoodCanvas","App","components_IVPlot","Component","location","hostname","match","ReactDOM","src_App_0","getElementById","navigator","serviceWorker","then","registration","unregister"],"mappings":"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","file":"static/js/main.83613a56.chunk.js","sourcesContent":["import { List, fromJS } from 'immutable';\r\nimport { ArrayToIntersectionNonNull } from 'utils/meta';\r\n\r\n// Useful merger to ignore undefined\r\n// Another difference: The merged result excludes properties not originally present in `target`\r\nexport function ignoreUndefined<V>(old: V, next: V) {\r\n  return next === undefined ? old : next;\r\n}\r\n\r\nexport function defaultMerger<V>(_old: V, next: V) {\r\n  return next;\r\n}\r\n\r\n// Like `Object.assign` but properties are merged deeply. Sources are copied not modified. Does not preserve reference equality for Immutable objects because the result is converted to a POJ. Use `_mergeDeep` to get an Immutable object back. Passing no sources will yield an empty object {}. Undefined values in `sources` are ignored (do not overwrite values in first source). Only considers own properties of objects (not properties inherited in their prototypes). Does not add new properties not originally in `target`.\r\nexport function mergeIntersect<T extends object, S extends any[]>(\r\n  target: T,\r\n  ...sources: S\r\n) {\r\n  return mergeIntersectWith(ignoreUndefined, target, ...sources) as T;\r\n}\r\n\r\n// Same as `mergeIntersect` but properties are merged deeply using the custom merge conflict resolver passed.\r\nexport function mergeIntersectWith<T extends object, S extends any[]>(\r\n  merger: <K, V>(old: V, next: V, key: K) => V,\r\n  target: T,\r\n  ...sources: S\r\n) {\r\n  // Filter out props not already present in `target`.\r\n  const selection = Object.keys(target);\r\n  sources = sources.filter(Boolean).map(source =>\r\n    // Special case for Array objects (preserve its prototype)\r\n    source instanceof Array\r\n      ? source\r\n      : Object.keys(source)\r\n          .filter(key => selection.includes(key))\r\n          .reduce((obj, key) => {\r\n            return {\r\n              ...obj,\r\n              [key]: (source as any)[key],\r\n            };\r\n          }, {})\r\n  ) as S;\r\n  return mergeWith(merger, target, ...sources) as T;\r\n}\r\n\r\n// Like `Object.assign` but properties are merged deeply. Sources are copied not modified. Does not preserve reference equality for Immutable objects because the result is converted to a POJ. Use `_mergeDeep` to get an Immutable object back. Passing no sources will yield an empty object {}. Undefined values in `sources` are ignored (do not overwrite values in first source). Only considers own properties of objects (not properties inherited in their prototypes).\r\n// Note: For some reason TypeScript doesn't recognize if you call merge() with both spread and individual arguments.\r\n// For instance `merge(...args, defaultSettings)` does not work!\r\n// My signature is probably at fault but I don't know how to fix it. (2/23/19)\r\nexport function merge<T extends any[]>(...sources: T) {\r\n  return mergeWith(ignoreUndefined, ...sources) as {\r\n    [K in keyof ArrayToIntersectionNonNull<T>]: ArrayToIntersectionNonNull<T>[K]\r\n  };\r\n}\r\n\r\n// Same as `merge` but properties are merged deeply using the custom merge conflict resolver passed.\r\nexport function mergeWith<T extends any[]>(\r\n  merger: <K, V>(old: V, next: V, key: K) => V,\r\n  ...sources: T\r\n) {\r\n  return _mergeDeepWith(merger, ...sources).toJS() as {\r\n    [K in keyof ArrayToIntersectionNonNull<T>]: ArrayToIntersectionNonNull<T>[K]\r\n  };\r\n}\r\n\r\nfunction isMergeable(a: any): a is { mergeWith: Function } {\r\n  return (\r\n    a &&\r\n    typeof a === 'object' &&\r\n    typeof a.mergeWith === 'function' &&\r\n    !List.isList(a)\r\n  );\r\n}\r\n\r\ntype Merger = <K, V>(oldVal: V, newVal: V, key?: K) => V;\r\nexport function _mergeDeepWith<T extends object[]>(\r\n  merger: Merger,\r\n  ...collections: T\r\n) {\r\n  /* \r\n  https://github.com/immutable-js/immutable-js/issues/1452#issuecomment-386162309\r\n  */\r\n  const _mergeDeep = <K, V>(a: V, b: V, key?: K): V | List<unknown> => {\r\n    // If b is null, it would overwrite a, even if a is mergeable\r\n    if (isMergeable(a) && b !== null) {\r\n      return a.mergeWith(_mergeDeep, b);\r\n    }\r\n\r\n    if (!List.isList(a) || !List.isList(b)) {\r\n      return merger(a, b, key);\r\n    }\r\n\r\n    return (b as List<unknown>).reduce(\r\n      (acc, nextItem, index) => {\r\n        const existingItem = acc.get(index);\r\n        if (isMergeable(existingItem)) {\r\n          return acc.set(index, existingItem.mergeWith(_mergeDeep, nextItem));\r\n        }\r\n\r\n        return acc.set(index, merger(existingItem, nextItem, index));\r\n      },\r\n      a as List<unknown>\r\n    );\r\n  };\r\n\r\n  return collections\r\n    .slice(1)\r\n    .reduce(\r\n      (acc, x) => _mergeDeep(acc, fromJS(x)),\r\n      fromJS(collections[0] != null ? collections[0] : {})\r\n    );\r\n}\r\n\r\nexport function _mergeDeep<T extends object[]>(...collections: T) {\r\n  return _mergeDeepWith(defaultMerger, ...collections);\r\n}\r\n\r\n// Example use:\r\nconst aaaaa = { hello: 3, canvasStyle: [1, 2, 3], canvasEffects: () => {} };\r\nconst bbbbb = { hello: 'world', canvasStyle: [3, , 1], poop: 'hiii' };\r\nconst ccccc = merge(aaaaa, bbbbb);\r\nconst ddddd = merge(...([aaaaa, bbbbb] as [typeof aaaaa, typeof bbbbb]));\r\n// const ccccc = merge();\r\n// console.log(ccccc);\r\n\r\n// Object.assign(window, {\r\n//   List,\r\n//   fromJS,\r\n//   _mergeDeepWith,\r\n//   _mergeDeep,\r\n//   merge,\r\n//   aaaaa,\r\n//   bbbbb,\r\n//   ccccc,\r\n// });\r\n","import ignore from './ignore';\r\n\r\nexport default (process.env.NODE_ENV === 'development' ? console.warn : ignore);\r\n","const ignore = (..._args: any[]) => {};\r\nexport default ignore;\r\n","import { Omit, Equals, RequiredOnly, ArrayToIntersectionNonNull } from './meta';\r\nimport * as withImm from './Imm/withImm';\r\nimport warn from './warn';\r\n\r\nexport type PropsClass = {\r\n  required?: object;\r\n  defaults?: object;\r\n  injected?: object;\r\n};\r\n\r\ntype Mix<T> = Pick<T, keyof T>;\r\n\r\n// Returns a factory that applies default props to props\r\nexport function declare<P extends PropsClass, S extends PropsClass[]>(\r\n  propsClass: P,\r\n  ...baseClasses: S\r\n) {\r\n  type R = P['required'] & {};\r\n  type D = P['defaults'] & {};\r\n  type I = P['injected'] & {};\r\n\r\n  type BasesR<T> = T extends PropsClass ? T['required'] : {};\r\n  type BasesD<T> = T extends PropsClass ? T['defaults'] : {};\r\n  type BasesI<T> = T extends PropsClass ? T['injected'] : {};\r\n  type BaseClasses = ArrayToIntersectionNonNull<S>;\r\n\r\n  // Properties in `propsClass.defaults` will make inherited properties with the same name optional, but will not affect properties in `propsClass.required`.\r\n  type Defaults = Mix<D & BasesD<BaseClasses>>;\r\n  type Required = Mix<R & Omit<BasesR<BaseClasses>, keyof Defaults>>;\r\n  type Injected = Mix<I & BasesI<BaseClasses>>;\r\n\r\n  // External-facing props interface\r\n  type PropsIn = Mix<Required & Partial<Defaults> & Partial<Injected>>;\r\n  // Internal-facing props interface\r\n  type PropsOut = Mix<Required & Defaults & Injected>;\r\n\r\n  const defaults = withImm.merge(\r\n    ...baseClasses.map(base => base.defaults),\r\n    propsClass.defaults as D\r\n  ) as Defaults;\r\n\r\n  // Warn about bad behavior with React refs\r\n  Object.keys(defaults).forEach(key => {\r\n    if (key === 'children') {\r\n      warn(`Don't use a default children prop! Refs will be lost.`);\r\n    } else if (\r\n      typeof defaults[key as keyof Defaults] === 'object' &&\r\n      'current' in defaults[key as keyof Defaults]\r\n    ) {\r\n      warn(\r\n        `Found an default property with a 'current' property. If this is a 'React.RefObject' beware that the ref may be lost! ${key}:`,\r\n        defaults[key as keyof Defaults]\r\n      );\r\n    }\r\n  });\r\n\r\n  // Type expanded inline for better tooltip\r\n  type Factory = (\r\n    props: { [K in keyof PropsIn]: PropsIn[K] }\r\n  ) => { [K in keyof PropsOut]: PropsOut[K] };\r\n\r\n  const factory: Factory = props => {\r\n    return {\r\n      ...props,\r\n      ...withImm.mergeIntersect(defaults, props),\r\n    } as ReturnType<Factory>;\r\n  };\r\n\r\n  // Runtime check for whether all props specified are optional (defaults or injected)\r\n  const allOptional = ![propsClass, ...baseClasses].some(c => 'required' in c);\r\n\r\n  type Decorated<T> = <U extends any[], V>(\r\n    props: PropsIn,\r\n    placeholder?: V,\r\n    ...rest: U\r\n  ) => T extends (...args: any[]) => infer W ? W : any;\r\n\r\n  type DecoratedOptional<T> = <U extends any[], V>(\r\n    props?: PropsIn,\r\n    placeholder?: V,\r\n    ...rest: U\r\n  ) => T extends (...args: any[]) => infer W ? W : any;\r\n\r\n  type AcceptsPropsOut = (props: PropsOut, ...rest: any[]) => any;\r\n\r\n  class Wrap {\r\n    static default<T extends AcceptsPropsOut>(f: T) {\r\n      const decorated: Decorated<T> = (props, placeholder, ...rest) => {\r\n        return f(\r\n          factory(props as Parameters<Factory>[0]),\r\n          placeholder,\r\n          ...rest\r\n        );\r\n      };\r\n\r\n      return decorated;\r\n    }\r\n\r\n    static optional<T extends AcceptsPropsOut>(f: T) {\r\n      return (Wrap.default(f) as unknown) as DecoratedOptional<T>;\r\n    }\r\n\r\n    // Select which Wrap signature to use depending on allOptional\r\n    static decorator = (allOptional ? Wrap.optional : Wrap.default) as Equals<\r\n      RequiredOnly<Required>,\r\n      {},\r\n      typeof Wrap.optional,\r\n      typeof Wrap.default\r\n    >;\r\n  }\r\n\r\n  type Me = { required: Required; defaults: Defaults; injected: Injected };\r\n\r\n  function extend<T extends PropsClass, U extends PropsClass[]>(\r\n    this: Me,\r\n    propsClass: T,\r\n    ...baseClasses: U\r\n  ) {\r\n    // Need to phrase it like this for type inference...\r\n    return declare(propsClass, declare(this, ...baseClasses));\r\n  }\r\n\r\n  const types = {\r\n    // Default arguments\r\n    defaults: defaults as { [K in keyof Defaults]: Defaults[K] },\r\n    // Required arguments\r\n    required: {} as { [K in keyof Required]: Required[K] },\r\n    // Values supplied not at the call site\r\n    injected: {} as { [K in keyof Injected]: Injected[K] },\r\n    // External-facing props interface (type)\r\n    propsIn: {} as { [K in keyof PropsIn]: PropsIn[K] },\r\n    // Internal-facing props interface (type)\r\n    propsOut: {} as { [K in keyof PropsOut]: PropsOut[K] },\r\n    // Class with my own required and defaults, discounting inherited properties\r\n    own: propsClass as { [K in keyof PropsClass]-?: P[K] & {} },\r\n    // List of base classes (filtered to just show their PropsClass fields)\r\n    bases: (baseClasses as unknown) as {\r\n      [K in keyof S]: S[K] extends PropsClass\r\n        ? { [L in keyof PropsClass]-?: S[K][L] }\r\n        : S[K]\r\n    },\r\n    // Decorator accepting a function whose props are to be transformed\r\n    wrap: Wrap['decorator'],\r\n    // Shortcut to declare() with this DefaultProps object as the baseClass\r\n    extend,\r\n  };\r\n\r\n  return Object.assign(factory, types);\r\n}\r\n\r\nexport function required<T extends object, S extends object[] = []>(\r\n  ..._others: S\r\n) {\r\n  type Others = ArrayToIntersectionNonNull<S>;\r\n  return declare(\r\n    class {\r\n      static required: T & Others;\r\n    }\r\n  );\r\n}\r\n\r\n// Arguments are deeply merged in reverse order.\r\nexport function defaults<T extends object[]>(...values: T) {\r\n  return declare(\r\n    class {\r\n      static defaults = withImm.merge(...(values.reverse() as T));\r\n    }\r\n  );\r\n}\r\n\r\nexport function injected<T extends object, S extends object[] = []>(\r\n  ..._others: S\r\n) {\r\n  type Others = ArrayToIntersectionNonNull<S>;\r\n  return declare(\r\n    class {\r\n      static injected: T & Others;\r\n    }\r\n  );\r\n}\r\n\r\n// Test usage:\r\n// import React from 'react';\r\n// import { GoodCanvasElement } from 'components/GoodCanvas';\r\n// import { BaseProps } from 'utils/BaseProps';\r\n// import noop from 'utils/noop';\r\n// class Props {\r\n//   static required: {\r\n//     canvasRef: React.RefObject<GoodCanvasElement> | 5;\r\n//     // canvasStyle: number;\r\n//   };\r\n//   static defaults = {\r\n//     // canvasStyle: {},\r\n//     canvasEffects: noop,\r\n//     canvasNeedsUpdate: 0,\r\n//   };\r\n// }\r\n\r\n// class PropsB {\r\n//   static required: {\r\n//     canvasRef: React.RefObject<GoodCanvasElement> | 5;\r\n//     canvasStyle: { hi: number }; // required if not parent\r\n//   };\r\n//   static defaults = {\r\n//     canvasStyle: {}, // only applied on inheritance\r\n//     canvasEffects: noop,\r\n//     canvasNeedsUpdate: 0,\r\n//   };\r\n// }\r\n\r\n// const a = bind(\r\n//   Props,\r\n//   // [1, 2],\r\n//   // withDefault(Props),\r\n//   // { hi: 'world', defaults: { ddd: 4 }, required: { hello: 'world' } },\r\n//   PropsB\r\n// );\r\n// const c = a.required;\r\n// const d = a.defaults;\r\n// const e = a.own.required;\r\n// const f = a.own.defaults;\r\n// const g = a.bases;\r\n// const h = a.propsIn;\r\n// const i = a.propsOut;\r\n// const j = a.decorate;\r\n// const b = a({ canvasRef: 5, canvasNeedsUpdate: 3 });\r\n// type DefaultProps = Pick<typeof b, keyof typeof b>;\r\n","import React, { SetStateAction } from 'react';\r\nimport { declare, defaults, injected } from 'utils/DefaultProps';\r\n\r\nexport const GoodCanvasElement = declare(\r\n  defaults({\r\n    dims: {\r\n      width: 300,\r\n      height: 150,\r\n    },\r\n    setNeedsUpdate: (() => {\r\n      throw new Error('Forgot to attach setNeedsUpdate...');\r\n    }) as React.Dispatch<SetStateAction<number>>,\r\n  }),\r\n  injected<HTMLCanvasElement>()\r\n);\r\n","import React from 'react';\r\nimport { GoodCanvasElement } from './GoodCanvasElement';\r\nimport { injected } from 'utils/DefaultProps';\r\n\r\nexport const Props = injected<{\r\n  canvasRef: React.RefObject<typeof GoodCanvasElement.propsOut>;\r\n  canvasNeedsUpdate: number;\r\n}>();\r\n","import React from 'react';\r\n\r\n// Throw on errors if given, otherwise return boolean result\r\nexport default function isValidRefObject<T>(\r\n  ref?: React.Ref<T>,\r\n  errors: {\r\n    REF_NULL?: any;\r\n    NO_CURRENT?: any;\r\n  } = {}\r\n): ref is React.RefObject<T> {\r\n  if (ref == null) {\r\n    if (errors.REF_NULL) throw Error(errors.REF_NULL);\r\n    return false;\r\n  } else if (!('current' in ref)) {\r\n    if (errors.NO_CURRENT) throw Error(errors.NO_CURRENT);\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n","import React from 'react';\r\nimport { GoodCanvasElement } from 'components/GoodCanvas';\r\nimport { enhanceContext, EnhancedContext } from '.';\r\nimport { isValidGoodCanvas } from './isValidGoodCanvas';\r\n\r\ntype K = typeof GoodCanvasElement.propsOut;\r\ntype V = { canvas: typeof GoodCanvasElement.propsOut; ctx: EnhancedContext };\r\nconst cache = new Map<K, V>();\r\n\r\nexport function getContext(\r\n  canvasRef: React.Ref<typeof GoodCanvasElement.propsOut>\r\n) {\r\n  // Throw on bad GoodCanvas\r\n  if (!isValidGoodCanvas(canvasRef)) {\r\n    // Not reached\r\n    throw Error();\r\n  }\r\n\r\n  // Return a previous enhanced canvas context from cache\r\n  const cached = cache.get(canvasRef.current!);\r\n  if (cached) {\r\n    return cached;\r\n  }\r\n\r\n  // Get the canvas context and enhance to track `currentTransform` property\r\n  const canvas = canvasRef.current!;\r\n  const ctx = canvas.getContext('2d')!;\r\n  const enhanced = enhanceContext(ctx);\r\n  const result = { canvas, ctx: enhanced };\r\n\r\n  // Cache the enhanced canvas context\r\n  cache.set(canvasRef.current!, result);\r\n\r\n  return result;\r\n}\r\n","import { GoodCanvasElement } from 'components/GoodCanvas';\r\nimport isValidRefObject from 'utils/isValidRefObject';\r\n\r\nexport function isValidGoodCanvas(\r\n  canvasRef: React.Ref<typeof GoodCanvasElement.propsOut>\r\n): canvasRef is React.RefObject<typeof GoodCanvasElement.propsOut> {\r\n  if (\r\n    !isValidRefObject(canvasRef, {\r\n      REF_NULL: '`canvasRef` should not be `null`',\r\n      NO_CURRENT:\r\n        'Use a React.RefObject not a functional ref. (`current` member not found in `canvasRef`.)',\r\n    })\r\n  ) {\r\n    // Not reached\r\n    throw Error();\r\n  }\r\n  if (canvasRef.current == null) {\r\n    throw Error('`canvasRef.current` should not be `null`');\r\n  }\r\n  return true;\r\n}\r\n","import { EnhancedContext } from '.';\r\nimport { getContext } from './getContext';\r\nimport { GoodCanvasElement } from 'components/GoodCanvas';\r\nimport { REF } from 'utils/easier';\r\n\r\n// in theory, SVGMatrix will be used by the Canvas API in the future;\r\n// in practice, we can borrow an SVG matrix today!\r\nfunction createMatrix() {\r\n  const svgNamespace = 'http://www.w3.org/2000/svg';\r\n  return document.createElementNS(svgNamespace, 'g').getCTM();\r\n}\r\n\r\n// `enhanceContext` takes a 2d canvas context and wraps its matrix-changing\r\n// functions so that `context.currentTransform` should always correspond to its\r\n// current transformation matrix.\r\n// Call `enhanceContext` on a freshly-fetched 2d canvas context for best\r\n// results.\r\nexport function enhanceContext(\r\n  context: CanvasRenderingContext2D\r\n): EnhancedContext {\r\n  // The main property we are enhancing the context to track\r\n  let currentTransform = createMatrix()!;\r\n\r\n  // the stack of saved matrices\r\n  const savedTransforms = [currentTransform];\r\n\r\n  const enhanced = {\r\n    currentTransform,\r\n    savedTransforms,\r\n    // helper for manually forcing the canvas transformation matrix to\r\n    // match the stored matrix.\r\n    _setMatrix() {\r\n      const m = enhanced.currentTransform!;\r\n      context.setTransform(m.a, m.b, m.c, m.d, m.e, m.f);\r\n    },\r\n\r\n    save() {\r\n      enhanced.savedTransforms.push(enhanced.currentTransform);\r\n      context.save();\r\n    },\r\n\r\n    // if the stack of matrices we're managing doesn't have a saved matrix,\r\n    // we won't even call the context's original `restore` method.\r\n    restore() {\r\n      if (enhanced.savedTransforms.length == 0) return;\r\n      context.restore();\r\n      enhanced.currentTransform = enhanced.savedTransforms.pop()!;\r\n      enhanced._setMatrix();\r\n    },\r\n\r\n    scale(x: number, y: number) {\r\n      enhanced.currentTransform = (<any>(\r\n        enhanced.currentTransform\r\n      )).scaleNonUniform(x, y);\r\n      context.scale(x, y);\r\n    },\r\n\r\n    rotate(theta: number) {\r\n      // canvas `rotate` uses radians, SVGMatrix uses degrees.\r\n      enhanced.currentTransform = enhanced.currentTransform!.rotate(\r\n        (theta * 180) / Math.PI\r\n      );\r\n      context.rotate(theta);\r\n    },\r\n\r\n    translate(x: number, y: number) {\r\n      enhanced.currentTransform = enhanced.currentTransform!.translate(x, y);\r\n      context.translate(x, y);\r\n    },\r\n\r\n    transform(\r\n      a: number,\r\n      b: number,\r\n      c: number,\r\n      d: number,\r\n      e: number,\r\n      f: number\r\n    ) {\r\n      const rhs = createMatrix()!;\r\n      // 2x2 scale-skew matrix\r\n      rhs.a = a;\r\n      rhs.b = b;\r\n      rhs.c = c;\r\n      rhs.d = d;\r\n\r\n      // translation vector\r\n      rhs.e = e;\r\n      rhs.f = f;\r\n      enhanced.currentTransform = enhanced.currentTransform!.multiply(rhs);\r\n      context.transform(a, b, c, d, e, f);\r\n    },\r\n\r\n    // Warning: `resetTransform` is not implemented in at least some browsers\r\n    // and this is _not_ a shim.\r\n    resetTransform() {\r\n      enhanced.currentTransform = createMatrix()!;\r\n      context.resetTransform();\r\n    },\r\n\r\n    isolate(f: () => void) {\r\n      enhanced.save();\r\n      f();\r\n      enhanced.restore();\r\n    },\r\n\r\n    get width() {\r\n      const { canvas } = getContext({\r\n        current: context.canvas,\r\n      } as REF<typeof GoodCanvasElement.propsOut>);\r\n      return canvas.dims.width;\r\n    },\r\n    get height() {\r\n      const { canvas } = getContext({\r\n        current: context.canvas,\r\n      } as REF<typeof GoodCanvasElement.propsOut>);\r\n      return canvas.dims.height;\r\n    },\r\n\r\n    call<T extends any[]>(\r\n      f: (...args: T) => any,\r\n      ...args: T\r\n    ): T extends (...args: any[]) => infer W ? W : any {\r\n      return f.call(enhanced, ...args);\r\n    },\r\n\r\n    deriveCoordinate(coord: Partial<{ width: number; height: number }>) {\r\n      const { width: w = 0, height: h = 0 } = coord;\r\n      const { width, height } = enhanced;\r\n      const result = w * width + h * height;\r\n      return result;\r\n    },\r\n\r\n    deriveCoordinates({\r\n      x = {},\r\n      y = {},\r\n    }: Partial<{\r\n      x: Partial<{ width: number; height: number }>;\r\n      y: Partial<{ width: number; height: number }>;\r\n    }>) {\r\n      return {\r\n        x: enhanced.deriveCoordinate(x),\r\n        y: enhanced.deriveCoordinate(y),\r\n      };\r\n    },\r\n  };\r\n\r\n  const handler = {\r\n    get: (target: any, key: string) => {\r\n      const value =\r\n        key in enhanced\r\n          ? (<any>enhanced)[key]\r\n          : key in target\r\n          ? target[key]\r\n          : undefined;\r\n      if (value === undefined) {\r\n        return value;\r\n      }\r\n      return typeof value === 'function'\r\n        ? (...args: any[]) => value.apply(target, args)\r\n        : value;\r\n    },\r\n    set: (target: any, key: string, value: any) => {\r\n      if (key in target) {\r\n        target[key] = value;\r\n      }\r\n      return true;\r\n    },\r\n  };\r\n\r\n  return new Proxy(context, handler);\r\n}\r\n\r\nexport function testIt() {\r\n  const canvas = document.createElement('canvas');\r\n  const ctx = canvas.getContext('2d')!;\r\n  const enhanced = enhanceContext(ctx);\r\n  const log = (msg: string) => {\r\n    const { a, b, c, d, e, f } = enhanced.currentTransform;\r\n    console.warn(msg, { a, b, c, d, e, f });\r\n  };\r\n  (<any>window).enhanced = enhanced;\r\n  log('initial');\r\n\r\n  enhanced.save();\r\n  enhanced.scale(1, 2);\r\n  log('scale(1,2)');\r\n  enhanced.restore();\r\n\r\n  enhanced.save();\r\n  enhanced.translate(10, 20);\r\n  log('translate(10,20)');\r\n  enhanced.restore();\r\n\r\n  enhanced.save();\r\n  enhanced.rotate(30);\r\n  log('rotate(30)');\r\n  enhanced.restore();\r\n\r\n  enhanced.save();\r\n  enhanced.scale(1, 2);\r\n  enhanced.translate(10, 20);\r\n  log('scale(1,2) translate(10,20)');\r\n  enhanced.restore();\r\n}\r\n","const noop = () => {};\r\nexport default noop;\r\n","import { useMemo, useRef } from 'react';\r\n\r\nexport function useMemoRef<T>(factory: () => T) {\r\n  const initialValue = useMemo(factory, []);\r\n  const ref = useRef(initialValue);\r\n\r\n  return ref;\r\n}\r\n","import React, { useEffect } from 'react';\r\nimport noop from 'utils/noop';\r\nimport { withImm } from 'utils/Imm';\r\n\r\nconst defaults = {\r\n  timeout: 250,\r\n  first: noop,\r\n  last: noop,\r\n};\r\n\r\ninterface Args extends Partial<typeof defaults> {\r\n  event: string;\r\n}\r\n\r\nexport function useThrottled(args: Args, inputs?: React.InputIdentityList) {\r\n  useEffect(() => {\r\n    const { event, first, last, timeout } = withImm.merge(defaults, args);\r\n\r\n    if (!event) return;\r\n\r\n    let ongoing = false;\r\n    let id: number;\r\n\r\n    const handler = () => {\r\n      // first resize event\r\n      if (!ongoing) {\r\n        if (first) first();\r\n        ongoing = true;\r\n      }\r\n\r\n      // dismiss pending events\r\n      if (id) clearTimeout(id);\r\n\r\n      // fulfill last response after timeout\r\n      id = window.setTimeout(() => {\r\n        ongoing = false;\r\n        if (last) last();\r\n      }, timeout);\r\n    };\r\n\r\n    window.addEventListener(event, handler);\r\n    return () => window.removeEventListener(event, handler);\r\n  }, inputs);\r\n}\r\n","import { useMemo, useCallback } from 'react';\r\nimport { withImm } from 'utils/Imm';\r\nimport Denque from 'denque';\r\n\r\nconst defaults = {\r\n  maxSize: Infinity,\r\n};\r\n\r\ninterface Args<T> extends Partial<typeof defaults> {\r\n  initialValue?: T[];\r\n}\r\n\r\nexport function useDataBufferSilent<T = number, U extends Array<T> = T[]>(\r\n  args: Args<T>\r\n): [Denque<T>, (newData: U) => void] {\r\n  const { initialValue, maxSize } = withImm.merge(defaults, args);\r\n  const buffer = useMemo(\r\n    () => (initialValue ? new Denque<T>(initialValue) : new Denque<T>()),\r\n    []\r\n  );\r\n  const updateBuffer = useCallback((newData: U) => {\r\n    buffer.splice(buffer.length, 0, ...newData);\r\n    if (buffer.length > maxSize!) {\r\n      buffer.splice(0, buffer.length - maxSize!);\r\n    }\r\n  }, []);\r\n  return [buffer, updateBuffer];\r\n}\r\n","import { useRef } from 'react';\r\nimport warn from 'utils/warn';\r\nimport { defaults, required } from 'utils/DefaultProps';\r\n\r\nconst Args = defaults({\r\n  initialValue: 0,\r\n  minDelta: 10, // ms\r\n  maxDelta: Infinity, // ms\r\n  halfLife: 250, // ms\r\n});\r\n\r\nconst UpdateArgs = required<{\r\n  datum: number;\r\n  delta: number; // ms\r\n}>();\r\n\r\nexport const useDecay = Args.wrap(\r\n  ({ initialValue, minDelta, maxDelta, halfLife }) => {\r\n    const signal = useRef(initialValue);\r\n\r\n    const update = UpdateArgs.wrap(({ datum, delta }) => {\r\n      const decay = Math.pow(0.5, delta / halfLife);\r\n      if (delta < minDelta) {\r\n      } else if (delta > maxDelta) signal.current = 1000 / delta;\r\n      else signal.current = decay * signal.current + (1 - decay) * datum;\r\n      if (isNaN(signal.current)) {\r\n        warn('Signal was NaN...');\r\n        signal.current = 0;\r\n      }\r\n      return signal.current;\r\n    });\r\n\r\n    return update;\r\n  }\r\n);\r\n","import React, { useMemo } from 'react';\r\nimport { makeImmHook } from 'utils/Imm';\r\nexport function useImm<\r\n  T extends (arg: any, inputs: React.InputIdentityList) => any\r\n>(hook: T) {\r\n  const ImmHook = useMemo(() => makeImmHook(hook), []);\r\n\r\n  return ImmHook;\r\n}\r\n\r\n// Test case (hover/uncomment to see types):\r\n// const aaaa = makeImmHook(React.useCallback);\r\n// const bbbb = aaaa(() => 3, []);\r\n// const cccc = makeImmHook(React.useEffect);\r\n// const dddd = cccc(() => 3, []); // number\r\n// const eeee = makeImmHook(React.useMemo);\r\n// const ffff = eeee(() => 3, []); // number\r\n// const gggg = aaaa(3, []); // [ts] Argument of type '3' is not assignable to parameter of type '() => {}'. [2345]\r\n","import React from 'react';\r\nimport { ImmMapType, fromJS } from 'utils/Imm';\r\nimport { useMemoRef } from 'utils/CustomHooks';\r\nimport { _mergeDeep } from './withImm';\r\n\r\ntype Callable = (...args: any[]) => any;\r\n\r\ntype UseCallBackCase<\r\n  T,\r\n  X extends Callable,\r\n  Else = never\r\n> = T extends typeof React.useCallback ? X : Else;\r\n\r\ntype UseEffectCase<\r\n  T,\r\n  X extends Callable,\r\n  Else = never\r\n> = T extends typeof React.useEffect ? void : Else;\r\n\r\ntype UseMemoCase<T, X extends Callable, Else = never> = X extends () => any\r\n  ? ReturnType<X>\r\n  : Else;\r\n\r\nexport function makeImmHook<\r\n  T extends (arg: any, inputs: React.InputIdentityList) => any\r\n>(hook: T) {\r\n  function ImmHook<X extends Callable>(\r\n    arg: X,\r\n    inputs: React.InputIdentityList\r\n  ): UseCallBackCase<T, X, UseEffectCase<T, X, UseMemoCase<T, X>>> {\r\n    const savedInputs = useMemoRef<ImmMapType<typeof inputs>>(() =>\r\n      fromJS(inputs)\r\n    );\r\n    savedInputs.current = _mergeDeep(savedInputs.current, inputs);\r\n\r\n    return hook(arg, [savedInputs.current]);\r\n  }\r\n\r\n  return ImmHook;\r\n}\r\n\r\n// Test case (hover/uncomment to see types):\r\n// const aaaa = makeImmHook(React.useCallback);\r\n// const bbbb = aaaa(() => 3, []);\r\n// const cccc = makeImmHook(React.useEffect);\r\n// const dddd = cccc(() => 3, []); // number\r\n// const eeee = makeImmHook(React.useMemo);\r\n// const ffff = eeee(() => 3, []); // number\r\n// const gggg = aaaa(3, []); // [ts] Argument of type '3' is not assignable to parameter of type '() => {}'. [2345]\r\n","import { EnhancedContext, CanvasStyle } from './EnhancedContext';\r\nimport noop from 'utils/noop';\r\nimport { defaults } from 'utils/DefaultProps';\r\nimport warn from 'utils/warn';\r\nimport { useImm } from 'utils/Imm';\r\nimport { useMemo } from 'react';\r\n\r\nexport type CanvasEffect = (ctx: EnhancedContext) => void;\r\n\r\nexport const EffectOptions = defaults({\r\n  style: {} as CanvasStyle,\r\n  injectEffect: noop as CanvasEffect,\r\n});\r\n\r\nconst Options = EffectOptions.extend(\r\n  defaults({\r\n    inputs: undefined as React.InputIdentityList | void,\r\n    injection: false,\r\n  })\r\n);\r\n\r\nexport function newEffect(\r\n  effect: CanvasEffect,\r\n  options: typeof Options.propsIn = {}\r\n) {\r\n  const { style, injectEffect, inputs, injection } = Options(options);\r\n\r\n  if (inputs != null)\r\n    return useImm(useMemo)(\r\n      () => effectChain as typeof Resolver['newEffect'],\r\n      inputs\r\n    );\r\n  else return effectChain as typeof Resolver['newEffect'];\r\n\r\n  function effectChain(\r\n    ...children: [EnhancedContext] | (CanvasEffect | null)[]\r\n  ) {\r\n    const render = (ctx: EnhancedContext) => {\r\n      const execute = () => {\r\n        Object.assign(ctx, style);\r\n        injectEffect(ctx);\r\n        effect(ctx);\r\n        (children as (CanvasEffect | null)[])\r\n          .filter(Boolean)\r\n          .forEach(e => e!(ctx));\r\n      };\r\n\r\n      if (injection) {\r\n        execute();\r\n      } else {\r\n        ctx.isolate(execute);\r\n      }\r\n    };\r\n\r\n    if (Resolver.isEnhancedContext(children[0])) {\r\n      const ctx = children[0];\r\n      if (children.length > 1) {\r\n        warn(\r\n          'This effect is ignoring the children it received because a canvas context was passed as its first argument. This is probably a programmer mistake. Ignored:',\r\n          children.slice(1)\r\n        );\r\n      }\r\n      children = [];\r\n      return render(ctx);\r\n    } else {\r\n      return render;\r\n    }\r\n  }\r\n}\r\n\r\nexport class Resolver {\r\n  static newEffect(ctx: EnhancedContext): void;\r\n  static newEffect(...children: (CanvasEffect | null)[]): CanvasEffect;\r\n  static newEffect(...children: [EnhancedContext] | (CanvasEffect | null)[]) {\r\n    return {} as void | CanvasEffect;\r\n  }\r\n  static isEnhancedContext(\r\n    arg: EnhancedContext | CanvasEffect | null\r\n  ): arg is EnhancedContext {\r\n    return (\r\n      arg instanceof CanvasRenderingContext2D && arg.currentTransform != null\r\n    );\r\n  }\r\n}\r\n","import { newEffect } from './newEffect';\r\n\r\nexport const clear = newEffect(ctx => {\r\n  const { width, height } = ctx;\r\n  ctx.clearRect(0, 0, width, height);\r\n});\r\n","import { withImm } from 'utils/Imm';\r\n\r\nexport interface Args {\r\n  event: string;\r\n  customEvent: string;\r\n  _window?: typeof window;\r\n}\r\n\r\nexport const defaultArgs = {\r\n  _window: window,\r\n};\r\n\r\nconst throttle = (args: Args) => {\r\n  // unpack args\r\n  const { _window } = withImm.mergeIntersect(defaultArgs, args);\r\n  const { event, customEvent } = args;\r\n\r\n  if (!event) throw Error('`event` should not be blank');\r\n  if (!customEvent) throw Error('`customEvent` should not be blank');\r\n\r\n  let ready = true;\r\n\r\n  const dispatcher = () => {\r\n    // dispatchEvent is synchronous (waits for event listener to finish running)\r\n    _window!.dispatchEvent(new CustomEvent(customEvent));\r\n    ready = true;\r\n  };\r\n\r\n  const throttler = () => {\r\n    if (ready) {\r\n      ready = false;\r\n      requestAnimationFrame(dispatcher);\r\n    }\r\n  };\r\n\r\n  _window!.addEventListener(event, throttler, { passive: true });\r\n\r\n  const cleanup = () => {\r\n    _window!.removeEventListener(event, throttler);\r\n  };\r\n\r\n  return cleanup;\r\n};\r\n\r\nexport const optimizedResize = 'optimized-resize';\r\nthrottle({ event: 'resize', customEvent: optimizedResize });\r\n\r\nexport default throttle;\r\n","import React from 'react';\r\nimport { declare, required, defaults } from './DefaultProps';\r\n\r\nexport const StyleProp = defaults({\r\n  style: {} as Partial<React.CSSProperties>,\r\n});\r\n\r\n// https://github.com/sw-yx/react-typescript-cheatsheet#useful-react-prop-type-examples\r\nexport const BaseProps = declare(\r\n  required<{\r\n    /* 1/9/19: SIGH. TypeScript can't check `children` because `React.createElement` returns back a super general `Element` type. */\r\n    children?: React.ReactNode;\r\n    onChange?: (e: React.FormEvent<HTMLInputElement>) => void;\r\n  }>(),\r\n  StyleProp\r\n);\r\n","import React, { useEffect } from 'react';\r\nimport { optimizedResize } from 'utils/throttleEvent';\r\nimport { useThrottled } from 'utils/CustomHooks';\r\nimport { BaseProps } from 'utils/BaseProps';\r\nimport { declare, defaults } from 'utils/DefaultProps';\r\nimport { REF } from 'utils/easier';\r\nimport { animated, useSpring } from 'react-spring';\r\n\r\nexport const Props = declare(\r\n  defaults({\r\n    radius: 5,\r\n    timeout: 250,\r\n    enabled: true,\r\n    style: { filter: '' } as typeof BaseProps.propsOut.style,\r\n  }),\r\n  BaseProps\r\n);\r\n\r\nexport const OwnProps = declare(Props.own);\r\n\r\nconst Blur = Props.wrap(\r\n  ({ children, style, radius, timeout, enabled }, ref: REF<HTMLDivElement>) => {\r\n    const [{ filter }, update] = useSpring(() => ({\r\n      filter: `${style.filter} blur(0px)`,\r\n      from: {\r\n        filter: `${style.filter} blur(${radius}px)`,\r\n      },\r\n      config: { duration: 250 },\r\n    }));\r\n\r\n    // attach handler to blur on window resize\r\n    useThrottled(\r\n      {\r\n        event: optimizedResize,\r\n        first: () =>\r\n          update({\r\n            filter: `${style.filter} blur(${enabled ? radius : 0}px)`,\r\n          }),\r\n        last: () =>\r\n          update({\r\n            filter: `${style.filter} blur(0px)`,\r\n          }),\r\n        timeout,\r\n      },\r\n      [timeout]\r\n    );\r\n\r\n    // attach handler to blur on window resize\r\n    useEffect(() => {\r\n      const handler = () => {\r\n        update({\r\n          filter: `${style.filter} blur(${\r\n            enabled && document.hidden ? radius : 0\r\n          }px)`,\r\n        });\r\n      };\r\n      document.addEventListener('visibilitychange', handler);\r\n      return () => document.removeEventListener('visibilitychange', handler);\r\n    }, [style.filter, enabled, radius]);\r\n\r\n    return (\r\n      <animated.div\r\n        ref={ref}\r\n        style={{\r\n          ...style,\r\n          filter: (filter as unknown) as string,\r\n        }}\r\n      >\r\n        {children}\r\n      </animated.div>\r\n    );\r\n  }\r\n);\r\n\r\nexport default React.forwardRef(Blur);\r\n","import { GoodCanvasElement } from './GoodCanvasElement';\r\nexport { GoodCanvasElement } from './GoodCanvasElement';\r\n\r\n// Re-export ChildProps.*\r\nimport { Props as GoodCanvasChild } from './GoodCanvasChild';\r\nexport { GoodCanvasChild };\r\n\r\nimport React, {\r\n  useLayoutEffect,\r\n  useRef,\r\n  useEffect,\r\n  useState,\r\n  useMemo,\r\n} from 'react';\r\nimport { scaleCanvas, getContext } from 'utils/canvas';\r\nimport { optimizedResize } from 'utils/throttleEvent';\r\nimport { useThrottled } from 'utils/CustomHooks';\r\nimport { propagateProps } from 'utils/propagateProps';\r\nimport { BaseProps } from 'utils/BaseProps';\r\nimport Blur, * as BlurNS from 'components/Blur';\r\nimport noop from 'utils/noop';\r\nimport { useImm } from 'utils/Imm';\r\nimport isValidRefObject from 'utils/isValidRefObject';\r\nimport { declare } from 'utils/DefaultProps';\r\nimport warn from 'utils/warn';\r\n\r\nconst Props = declare(\r\n  class {\r\n    static required: {\r\n      blur?: typeof BlurNS.OwnProps.propsIn;\r\n    };\r\n    static defaults = {\r\n      style: {\r\n        position: 'relative',\r\n        overflow: 'hidden',\r\n        width: '300px',\r\n        height: '150px',\r\n        boxSizing: 'content-box',\r\n      } as typeof BaseProps.propsOut.style,\r\n      timeout: 500,\r\n      notify: noop,\r\n    };\r\n  },\r\n  BaseProps\r\n);\r\n\r\n/* \r\n  A properly scaled <canvas> element accounting for window.devicePixelRatio.\r\n\r\n  Set the size and other layout properties of GoodCanvas directly through the CSS style prop.\r\n\r\n  GoodCanvas attaches all props listed in the GoodCanvasChildPropsType to its child components:\r\n    1. `canvasRef` -- ref to internal <canvas> element.\r\n    2. `canvasNeedsUpdate` -- counter incremented when GoodCanvas is rescaled.\r\n\r\n  These new props allow child components to have access to the canvas rendering context as well as to be informed when they should re-render, since rescaling the <canvas> clears all its pixels.\r\n  \r\n  To toggle warnings use the `showWarnings` boolean prop.\r\n*/\r\nconst GoodCanvas: React.RefForwardingComponent<\r\n  typeof GoodCanvasElement.propsOut,\r\n  typeof Props.propsOut\r\n> = (props, ref) => {\r\n  // stateful variables\r\n  const [needsUpdate, setNeedsUpdate] = useState(0);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const canvasRef = useRef<typeof GoodCanvasElement.propsOut>(null);\r\n  const firstRender = useRef(true);\r\n\r\n  // Populate forwardedRef if not given (to be used internally).\r\n  ref = ref || canvasRef;\r\n\r\n  // Verify the ref passed is not a custom functional ref.\r\n  if (!isValidRefObject(canvasRef)) {\r\n    // Not reached\r\n    throw Error();\r\n  }\r\n\r\n  // Populate default props.\r\n  const { blur, children, style, timeout, notify } = props;\r\n\r\n  // Scale the canvas resolution.\r\n  useImm(useLayoutEffect)(() => {\r\n    const container = containerRef.current!;\r\n    const { canvas, ctx } = getContext(ref);\r\n    const computeStyle = (property: string) =>\r\n      parseFloat(window.getComputedStyle(container).getPropertyValue(property));\r\n    let width = computeStyle('width');\r\n    let height = computeStyle('height');\r\n\r\n    // Subtract padding and border.\r\n    if (container.style.boxSizing == 'border-box') {\r\n      // Get padding and border offsets for one direction.\r\n      const getTotalOffset = (direction: string) => {\r\n        return (\r\n          computeStyle(`border-${direction}-width`) +\r\n          computeStyle(`padding-${direction}`)\r\n        );\r\n      };\r\n\r\n      // Subtract horizontal offset.\r\n      width -= getTotalOffset('left') + getTotalOffset('right');\r\n\r\n      // Subtract vertical offset.\r\n      height -= getTotalOffset('top') + getTotalOffset('bottom');\r\n    }\r\n\r\n    // Hard work happens here.\r\n    const t = performance.now();\r\n    scaleCanvas({ canvas, width, height, ctx });\r\n    warn(\r\n      `GoodCanvas rescale complete. (${(performance.now() - t).toFixed(2)} ms)`\r\n    );\r\n\r\n    // Notify parents\r\n    if (!firstRender.current && notify) notify();\r\n  }, [needsUpdate, style]);\r\n\r\n  // Attach setNeedsUpdate to canvas DOM element.\r\n  useLayoutEffect(() => {\r\n    const { canvas } = getContext(ref);\r\n    canvas.setNeedsUpdate = setNeedsUpdate;\r\n  }, []);\r\n\r\n  // Attach event listener to re-render on window resize.\r\n  useThrottled(\r\n    {\r\n      event: optimizedResize,\r\n      first: () =>\r\n        warn(\r\n          'GoodCanvas is rescaling because the window resized. If this is happening often, there could be a negative performance impact.'\r\n        ),\r\n      last: () => setNeedsUpdate(i => i + 1),\r\n      timeout: timeout,\r\n    },\r\n    [timeout]\r\n  );\r\n\r\n  // Warn about re-scale when styles change.\r\n  useImm(useEffect)(() => {\r\n    if (firstRender.current) {\r\n      return;\r\n    }\r\n    warn(\r\n      'GoodCanvas is rescaling because the `style` prop changed. If this is happening often, there could be a negative performance impact.'\r\n    );\r\n  }, [style]);\r\n\r\n  // Mark first render cycle complete.\r\n  useEffect(() => {\r\n    firstRender.current = false;\r\n  }, []);\r\n\r\n  // Warn on unmount to help detect undesired behavior.\r\n  useEffect(() => {\r\n    return () =>\r\n      warn(\r\n        'GoodCanvas is unmounting. If this is happening often, there could be a negative performance impact.'\r\n      );\r\n  }, []);\r\n\r\n  warn('GoodCanvas RENDER');\r\n\r\n  // Attach GoodCanvasChildPropsType props to children subtree.\r\n  const decoratedChildren = useImm(useMemo)(() => {\r\n    return propagateProps<typeof GoodCanvasChild.propsIn>(children, _child => {\r\n      return {\r\n        canvasRef: ref as React.RefObject<typeof GoodCanvasElement.propsOut>,\r\n        canvasNeedsUpdate: needsUpdate,\r\n      };\r\n    });\r\n  }, [needsUpdate, children, ref]);\r\n\r\n  return (\r\n    <div style={style} ref={containerRef}>\r\n      <Blur style={{ width: '100%', height: '100%' }} {...blur}>\r\n        <canvas\r\n          style={{\r\n            position: 'absolute',\r\n            left: 0,\r\n            top: 0,\r\n            margin: 0,\r\n            padding: 0,\r\n            border: 'none',\r\n          }}\r\n          ref={ref}\r\n        >\r\n          {decoratedChildren}\r\n        </canvas>\r\n      </Blur>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default React.forwardRef(Props.wrap(GoodCanvas));\r\n","import { GoodCanvasElement } from 'components/GoodCanvas';\r\nimport { EnhancedContext } from '.';\r\n\r\nexport interface Args {\r\n  canvas: HTMLCanvasElement;\r\n  width: number;\r\n  height: number;\r\n  ctx?: EnhancedContext;\r\n}\r\n\r\n/*\r\nhttps://stackoverflow.com/questions/15661339/how-do-i-fix-blurry-text-in-my-html5-canvas/54027313#54027313\r\n*/\r\nexport function scaleCanvas(args: Args) {\r\n  // Unpack arguments.\r\n  const { canvas, ctx: enhanced } = args;\r\n  let { width, height } = args;\r\n\r\n  // Get pixel ratio.\r\n  const dpr = window.devicePixelRatio;\r\n\r\n  // Size the canvas a bit bigger than desired.\r\n  const [savedWidth, savedHeight] = [width, height];\r\n  width = Math.ceil(width * dpr);\r\n  height = Math.ceil(height * dpr);\r\n\r\n  // Set the canvas resolution dimensions (integer values).\r\n  canvas.width = width;\r\n  canvas.height = height;\r\n\r\n  // Set the canvas layout dimensions with respect to the canvas\r\n  // resolution dimensions. (Not necessarily integer values!)\r\n  canvas.style.width = `${width / dpr}px`;\r\n  canvas.style.height = `${height / dpr}px`;\r\n\r\n  // Adjust canvas coordinates to use CSS pixel coordinates.\r\n  const ctx = enhanced || canvas.getContext('2d')!;\r\n  ctx.resetTransform();\r\n  ctx.scale(dpr, dpr);\r\n\r\n  // Only draw visible region.\r\n  ctx.beginPath();\r\n  ctx.rect(0, 0, savedWidth, savedHeight);\r\n  ctx.clip();\r\n\r\n  // Save bounding dimensions in Canvas coordinates.\r\n  (canvas as typeof GoodCanvasElement.propsOut).dims = GoodCanvasElement({\r\n    dims: {\r\n      width: savedWidth,\r\n      height: savedHeight,\r\n    },\r\n  }).dims;\r\n}\r\n","import React from 'react';\r\nimport { BaseProps } from './BaseProps';\r\n\r\nexport function propagateProps<P = typeof BaseProps.propsIn>(\r\n  children: React.ReactNode,\r\n  props: (\r\n    child: React.ReactElement<P & { children?: React.ReactNode }>\r\n  ) => P | Partial<P>\r\n) {\r\n  if (!children) return null;\r\n  return (\r\n    <>\r\n      {React.Children.map(children, child => {\r\n        if (React.isValidElement<P & { children?: React.ReactNode }>(child)) {\r\n          // recurse down\r\n          propagateProps(child.props.children, props);\r\n          // attach to current node and return\r\n          if (typeof props == 'function') {\r\n            return React.cloneElement<P>(child, props(child));\r\n          } else {\r\n            return React.cloneElement<P>(child, props);\r\n          }\r\n        } else {\r\n          return child;\r\n        }\r\n      })}\r\n    </>\r\n  );\r\n}\r\n","import { Pair } from 'utils/Pair';\r\nimport { defaults, required } from 'utils/DefaultProps';\r\nimport { newEffect, EffectOptions, CanvasStyle } from 'utils/canvas';\r\nimport { REF } from 'utils/easier';\r\n\r\nexport const Args = EffectOptions.extend(\r\n  required<{ data: REF<Pair[]> }>(),\r\n  defaults({\r\n    radius: 3,\r\n    style: {\r\n      fillStyle: 'hsl(330, 100%, 75%)',\r\n      strokeStyle: 'hsl(330, 100%, 50%)',\r\n      lineWidth: 0.5,\r\n    } as CanvasStyle,\r\n  })\r\n);\r\n\r\n/* \r\n{\r\n  offsetX: 0,\r\n  offsetY: 0,\r\n  blurRadius: 5,\r\n  spreadRadius: 0.5,\r\n  // use alpha = 0.5 for light-mode\r\n  color: 'hsl(330, 100%, 50%)',\r\n}\r\n*/\r\nexport const usePoints = Args.wrap(({ data, radius, ...effectOptions }) =>\r\n  newEffect(ctx => {\r\n    for (const [x, y] of data.current) {\r\n      ctx.beginPath();\r\n      ctx.arc(x, y, radius, 0, 2 * Math.PI);\r\n      ctx.fill();\r\n      ctx.stroke();\r\n    }\r\n  }, effectOptions)\r\n);\r\n","import { useMemo } from 'react';\r\nimport * as d3 from 'd3';\r\nimport { Pair } from 'utils/Pair';\r\nimport { evaluate } from 'utils/evaluate';\r\nimport { required, defaults } from 'utils/DefaultProps';\r\nimport { newEffect, EffectOptions } from 'utils/canvas';\r\nimport { REF } from 'utils/easier';\r\n\r\nexport const Args = EffectOptions.extend(\r\n  required<{ data: REF<Pair[]> }>(),\r\n  defaults({\r\n    // alpha = 0.5 gives centripetal CatmullRom\r\n    line: 'd3.line().curve(d3.curveCatmullRom.alpha(0.5))' as\r\n      | d3.Line<Pair>\r\n      | string,\r\n  })\r\n);\r\n\r\nexport const useLine = Args.wrap(({ data, line, ...effectOptions }) => {\r\n  const theLine = useMemo(\r\n    () =>\r\n      (typeof line === 'string' ? evaluate(line, { d3 }) : line) as d3.Line<\r\n        Pair\r\n      >,\r\n    [line]\r\n  );\r\n  return newEffect(ctx => {\r\n    theLine.context(ctx);\r\n    ctx.beginPath();\r\n    theLine(data.current);\r\n    ctx.stroke();\r\n  }, effectOptions);\r\n});\r\n","export const evaluate = (expr: string, context: any = {}) =>\r\n  Function(...Object.keys(context), `'use strict';return ${expr}`)(\r\n    ...Object.keys(context).map(k => context[k])\r\n  );\r\n","import { useEffect } from 'react';\r\nimport { Pair } from 'utils/Pair';\r\nimport { useDataBufferSilent } from 'utils/CustomHooks';\r\nimport { declare, required, defaults } from 'utils/DefaultProps';\r\n\r\nconst Args = declare(\r\n  required<{\r\n    samplePeriod: number; // ms\r\n  }>(),\r\n  defaults({\r\n    maxSize: 1000,\r\n    initialValue: [] as Pair[],\r\n  })\r\n);\r\n\r\nexport const useDataFeed = Args.wrap(\r\n  ({ samplePeriod, maxSize, initialValue }) => {\r\n    const [buffer, concat] = useDataBufferSilent<Pair>({\r\n      maxSize,\r\n      initialValue,\r\n    });\r\n\r\n    useEffect(() => {\r\n      let id: number;\r\n\r\n      const receiveData = () => {\r\n        concat([generate()]);\r\n        id = window.setTimeout(\r\n          receiveData,\r\n          samplePeriod + 250 * (Math.random() - 0.5)\r\n        );\r\n      };\r\n      receiveData();\r\n\r\n      return () => clearTimeout(id);\r\n    }, []);\r\n\r\n    return buffer;\r\n  }\r\n);\r\n\r\nconst CURRENT = [3.1, 3.2, 2.1, 2.0, 2.9, 1.8, 4.5, 4.2];\r\nconst [lo, hi] = [Math.min(...CURRENT), Math.max(...CURRENT)];\r\nconst generate = (): Pair => [Date.now(), Math.random() * (hi - lo) + lo];\r\n\r\nconst initialValue = CURRENT.map((v, i): Pair => [i * 500, v]);\r\n","import { withImm } from './Imm';\r\n\r\nconst clamp = (x: number, range: [number?, number?]) => {\r\n  const [lo, hi] = withImm.mergeIntersect([-Infinity, Infinity], range);\r\n  return Math.min(hi, Math.max(lo, x));\r\n};\r\n\r\nexport default clamp;\r\n","import { Pair } from 'utils/Pair';\r\nimport { useSpring, OpaqueInterpolation, SetUpdateFn } from 'react-spring';\r\nimport Denque from 'denque';\r\nimport * as d3 from 'd3';\r\nimport clamp from 'utils/clamp';\r\nimport { useMemo, useRef } from 'react';\r\nimport { newEffect } from 'utils/canvas';\r\nimport { required, defaults, declare } from 'utils/DefaultProps';\r\nimport { REF } from 'utils/easier';\r\n\r\nconst Args = declare(\r\n  required<{\r\n    scaleX: d3.ScaleLinear<number, number>;\r\n    scaleY: d3.ScaleLinear<number, number>;\r\n    buffer: Denque<Pair>;\r\n    padding: {\r\n      by: OpaqueInterpolation<number>;\r\n      update: SetUpdateFn<{ by: number }>;\r\n      immediate: REF<number>;\r\n    };\r\n  }>(),\r\n  defaults({\r\n    // fraction of timespan to extend memory by for vertical autoscaling\r\n    extraHistory: 0,\r\n  })\r\n);\r\n\r\nexport const useView = Args.wrap(\r\n  ({ scaleX, scaleY, buffer, extraHistory, padding }) => {\r\n    const [{ extent }, update] = useSpring(() => ({\r\n      extent: [0, 0],\r\n      config: { tension: 60, friction: 10 },\r\n    }));\r\n    const currentScaleX = scaleX.copy();\r\n    const bisector = useMemo(() => d3.bisector((d: Pair) => d[0]), []);\r\n    const transformed = useRef([] as Pair[]);\r\n\r\n    const effect = newEffect(() => {\r\n      // Adjust the input scale domain for current time.\r\n      const now = Date.now();\r\n      currentScaleX.domain(\r\n        scaleX.domain().map(x => x + now - padding.by.value)\r\n      );\r\n      const [start, end] = currentScaleX.domain();\r\n      const timespan = end - start;\r\n\r\n      // Find indices in buffer corresponding to [start, end] times.\r\n      const history = extraHistory * timespan;\r\n      const left = bisector.left(buffer, start - history);\r\n      const right = bisector.right(buffer, end, left);\r\n\r\n      // Pad indices a little so the edge-jitter of the spline is not visible.\r\n      const pad = 2;\r\n      const padRight = clamp(right + pad, [, buffer.length]);\r\n      const padLeft = clamp(left - pad, [0]);\r\n\r\n      // Calculate error in padding (if padRight was ineffective)\r\n      const unpadRight = clamp(padRight - 2, [0]);\r\n      if (buffer.length) {\r\n        const by = buffer[right - 1][0] - buffer[unpadRight - 1][0];\r\n        padding.immediate.current = clamp(by, [padding.immediate.current]);\r\n        padding.update({ by: padding.immediate.current });\r\n      }\r\n\r\n      // Slice the view of the buffer.\r\n      let view = buffer.slice(padLeft, padRight);\r\n\r\n      // TODO: If I have a lot of free time, add striding to the view, with consistent phase.\r\n\r\n      // Set y-axis scaling for view\r\n      if (view.length) {\r\n        update({ extent: d3.extent(view, d => d[1]) as Pair });\r\n      }\r\n\r\n      Object.assign(window, {\r\n        extent: extent.value,\r\n        timespan,\r\n        left,\r\n        right,\r\n        buffer,\r\n        hist: history,\r\n        start,\r\n        end,\r\n        now,\r\n        length: transformed.current.length,\r\n        transformed,\r\n      });\r\n      // debugger;\r\n      scaleY.domain(extent.value);\r\n      transformed.current = view.map(\r\n        ([x, y]): Pair => [currentScaleX(x), scaleY(y)]\r\n      );\r\n    });\r\n\r\n    return { view: transformed, update: effect, scaleX: currentScaleX };\r\n  }\r\n);\r\n","import { newEffect } from 'utils/canvas';\r\nimport { declare, required, defaults } from 'utils/DefaultProps';\r\nimport { useRef } from 'react';\r\n\r\nconst Args = declare(\r\n  defaults({ period: 300 }), // ms\r\n  required<{ segments: number[] }>()\r\n);\r\n\r\nexport const useDash = Args.wrap(({ segments, period }) => {\r\n  const total = segments.reduce((a, x) => a + x, 0);\r\n\r\n  const offset = useRef(0);\r\n\r\n  return newEffect(\r\n    ctx => {\r\n      ctx.setLineDash(segments);\r\n      ctx.lineDashOffset = offset.current =\r\n        (offset.current + total * (1000 / 60 / period)) % total;\r\n    },\r\n    { inputs: [segments] }\r\n  );\r\n});\r\n","import { newEffect, EffectOptions, RelativeCoordinates } from 'utils/canvas';\r\nimport { useMemoRef, useDecay } from 'utils/CustomHooks';\r\nimport { config, useSpring } from 'react-spring';\r\nimport { defaults } from 'utils/DefaultProps';\r\n\r\nconst Args = EffectOptions.extend(\r\n  defaults({\r\n    position: {\r\n      x: {\r\n        width: 1,\r\n        height: 0,\r\n      },\r\n      y: {\r\n        width: 0,\r\n        height: 1,\r\n      },\r\n    } as RelativeCoordinates,\r\n    offset: {\r\n      x: {\r\n        width: 0,\r\n        height: -0.05,\r\n      },\r\n      y: {\r\n        width: 0,\r\n        height: -0.025,\r\n      },\r\n    } as RelativeCoordinates,\r\n    style: {\r\n      font: '20px ubuntu mono, monospace',\r\n      fillStyle: '#fff',\r\n    } as typeof EffectOptions.propsOut.style,\r\n  }),\r\n  EffectOptions\r\n);\r\n\r\nexport const useFPS = Args.wrap(args => {\r\n  const { position, offset, ...effectOptions } = args;\r\n  const updateDecay = useDecay({ halfLife: 125 });\r\n  const [{ delta }, update] = useSpring(() => ({\r\n    delta: 0,\r\n    config: config.slow,\r\n  }));\r\n  const last = useMemoRef(() => performance.now());\r\n\r\n  return newEffect(\r\n    ctx => {\r\n      // Update metrics\r\n      const now = performance.now();\r\n      const decayed = updateDecay({\r\n        datum: now - last.current,\r\n        delta: now - last.current,\r\n      });\r\n      update({ delta: decayed });\r\n      last.current = now;\r\n      const fps = delta.value > 10 ? 1000 / delta.value : 60;\r\n\r\n      // Display to canvas\r\n      const text = `${fps.toFixed(1)} FPS`;\r\n      const { width: textWidth } = ctx.measureText(text);\r\n      const { x, y } = ctx.deriveCoordinates(position);\r\n      const { x: offsetX, y: offsetY } = ctx.deriveCoordinates(offset);\r\n      ctx.fillText(text, x + offsetX - textWidth, y + offsetY);\r\n    },\r\n    {\r\n      inputs: [args],\r\n      ...effectOptions,\r\n    }\r\n  );\r\n});\r\n","import { useMemo, useEffect } from 'react';\r\nimport { GoodCanvasChild } from 'components/GoodCanvas';\r\nimport { getContext, RelativeCoordinates } from 'utils/canvas';\r\nimport * as d3 from 'd3';\r\nimport { required, declare } from 'utils/DefaultProps';\r\n\r\nconst Args = declare(\r\n  required<{\r\n    padding: RelativeCoordinates;\r\n  }>(),\r\n  required(GoodCanvasChild.propsOut)\r\n);\r\n\r\nexport const useScalesXY = Args.wrap(\r\n  ({ canvasRef, canvasNeedsUpdate, padding }) => {\r\n    const [scaleX, scaleY] = useMemo(\r\n      () => [d3.scaleLinear(), d3.scaleLinear()],\r\n      []\r\n    );\r\n\r\n    // initialize axes scales\r\n    useEffect(() => {\r\n      const { canvas, ctx } = getContext(canvasRef);\r\n      const { width, height } = canvas.dims;\r\n      const { x: padX, y: padY } = ctx.deriveCoordinates(padding);\r\n      scaleX.range([padX, width - padX]);\r\n      scaleY.range([padY, height - padY]);\r\n    }, [canvasNeedsUpdate]);\r\n\r\n    return [scaleX, scaleY];\r\n  }\r\n);\r\n","import { GoodCanvasChild } from 'components/GoodCanvas';\r\nimport { getContext } from 'utils/canvas';\r\nimport { useEffect, useState } from 'react';\r\nimport { declare, required } from 'utils/DefaultProps';\r\n\r\nconst Args = declare(\r\n  required({} as {\r\n    speed: number; // translate by pixels / second\r\n  }),\r\n  required(GoodCanvasChild.propsOut)\r\n);\r\n\r\n// update timespan and stride (based on canvas width and zoom)\r\nexport const useTimespan = Args.wrap(\r\n  ({ canvasRef, canvasNeedsUpdate, speed }) => {\r\n    const [timespan, update] = useState(0);\r\n    useEffect(() => {\r\n      const { canvas } = getContext(canvasRef);\r\n      update(canvas.dims.width / (speed / 1000));\r\n    }, [canvasNeedsUpdate]);\r\n\r\n    return timespan; // ms\r\n  }\r\n);\r\n","import { useCounter, useSilentCounter } from 'utils/CustomHooks';\r\nimport { useEffect, useRef } from 'react';\r\nimport noop from 'utils/noop';\r\n\r\nexport function useAnimationFrame(\r\n  f: () => void = noop,\r\n  { silent = true, interval = 16 } = {},\r\n  inputs?: React.InputIdentityList\r\n) {\r\n  const firstTime = useRef(true);\r\n  useEffect(() => {\r\n    if (firstTime.current) {\r\n      firstTime.current = false;\r\n    } else {\r\n      console.error(\r\n        \"Options passed to useAnimationFrame were toggled in the same lifecycle of the component. Don't do this! Options must be kept constant or React hooks won't work.\"\r\n      );\r\n    }\r\n  }, [silent, interval]);\r\n\r\n  const [, nextFrame] = silent ? useSilentCounter() : useCounter();\r\n\r\n  if (interval == 16) {\r\n    useEffect(() => {\r\n      const loop = () => {\r\n        f();\r\n        nextFrame();\r\n        id = window.requestAnimationFrame(loop);\r\n      };\r\n      let id = window.requestAnimationFrame(loop);\r\n      return () => window.cancelAnimationFrame(id);\r\n    }, inputs);\r\n  } else {\r\n    useEffect(() => {\r\n      const loop = () => {\r\n        f();\r\n        nextFrame();\r\n      };\r\n      let id = window.setInterval(loop, interval);\r\n      return () => window.clearInterval(id);\r\n    }, inputs);\r\n  }\r\n}\r\n","import { useRef, useCallback } from 'react';\r\n\r\nexport function useSilentCounter(initial: number = 0): [number, () => void] {\r\n  const value = useRef(initial);\r\n  const increment = useCallback(() => value.current++, []);\r\n  return [value.current, increment];\r\n}\r\n","import { useState, useCallback } from 'react';\r\n\r\nexport function useCounter(initial: number = 0): [number, () => void] {\r\n  const [value, setValue] = useState(initial);\r\n  const increment = useCallback(() => setValue(i => i + 1), []);\r\n  return [value, increment];\r\n}\r\n","import { newEffect } from 'utils/canvas';\r\nimport { defaults } from 'utils/DefaultProps';\r\nimport { RelativeCoordinate } from 'utils/canvas/EnhancedContext';\r\n\r\nconst Args = defaults({\r\n  by: {\r\n    width: 0,\r\n    height: 0.05,\r\n  } as RelativeCoordinate,\r\n  invert: false,\r\n});\r\n\r\nexport const useClip = Args.wrap(({ invert, by }) => {\r\n  return newEffect(ctx => {\r\n    const { width, height } = ctx;\r\n    const clipBy = ctx.deriveCoordinate(by);\r\n    const region = new Path2D();\r\n    ctx.beginPath();\r\n    region.rect(clipBy, 0, width - 2 * clipBy, height);\r\n    if (invert) {\r\n      region.rect(0, 0, width, height);\r\n    }\r\n    ctx.clip(region, 'evenodd');\r\n  });\r\n});\r\n","const identity = <T = any>(arg: T) => arg;\r\nexport default identity;\r\n","import { Pair } from 'utils/Pair';\r\nimport identity from './identity';\r\n\r\nexport const diff = <T>(d: Pair<T>, convert: (x: T) => any = identity) =>\r\n  +convert(d[1]) - +convert(d[0]);\r\n","import { useMemo, useEffect, useRef } from 'react';\r\nimport * as d3 from 'd3';\r\nimport { getContext, newEffect } from 'utils/canvas';\r\nimport { required, declare } from 'utils/DefaultProps';\r\nimport { GoodCanvasChild, GoodCanvasElement } from 'components/GoodCanvas';\r\nimport { withImm, fromJS, ImmMapType, useImm } from 'utils/Imm';\r\nimport { Pair } from 'utils/Pair';\r\nimport noop from 'utils/noop';\r\nimport { REF } from 'utils/easier';\r\nimport { diff } from '../../utils/diff';\r\n\r\nconst Args = declare(\r\n  required<{\r\n    baseScale: d3.ScaleLinear<number, number>;\r\n  }>(),\r\n  required(GoodCanvasChild.propsOut)\r\n);\r\n\r\nconst slope = (s: d3.ScaleLinear<number, number>) =>\r\n  diff(s.range() as Pair) / diff(s.domain() as Pair);\r\ntype Zoom = d3.ZoomBehavior<typeof GoodCanvasElement.propsOut, any>;\r\n\r\nexport const useControls = Args.wrap(\r\n  ({ baseScale, canvasRef, canvasNeedsUpdate }) => {\r\n    const zoomedScale = baseScale.copy();\r\n    const effect = useRef(noop);\r\n\r\n    const zoom: Zoom = useMemo(\r\n      () =>\r\n        d3\r\n          .zoom<typeof GoodCanvasElement.propsOut, any>()\r\n          .scaleExtent([1 / 5, 1]),\r\n      []\r\n    );\r\n\r\n    useEffect(() => {\r\n      const { canvas } = getContext(canvasRef);\r\n      const { width, height } = canvas.dims;\r\n      zoom.extent([[0, 0], [width, height]]);\r\n      zoom.translateExtent([\r\n        [-Infinity, 0],\r\n        [width, height],\r\n        // [-20 * diff(baseScale.range() as Pair), 0],\r\n        // [baseScale.range()[1], 0],\r\n      ]);\r\n    }, [canvasNeedsUpdate]);\r\n\r\n    useImm(useEffect)(() => {\r\n      const { canvas } = getContext(canvasRef);\r\n      const selection = d3.select(canvas);\r\n\r\n      const { onStart, onEnd } = playPause({\r\n        zoom,\r\n        baseScale,\r\n        selection,\r\n        effect,\r\n      });\r\n\r\n      zoom\r\n        .on('zoom', () => {\r\n          const t = d3.event.transform as ReturnType<typeof d3.zoomTransform>;\r\n          zoomedScale.domain(t.rescaleX(baseScale).domain());\r\n          Object.assign(window, { zoomedScale });\r\n        })\r\n        .on('start', onStart)\r\n        .on('end', onEnd);\r\n      // TODO: Make onEnd also translate with some momentum\r\n\r\n      // TODO: Use zoom.translateTo, zoom.scaleTo, and useSpring to do this without a duration? (Spring transitions between d3.zoomTransform(canvas) and d3.zoomIdentity)\r\n      selection.call(zoom).on('dblclick.zoom', () => {\r\n        selection\r\n          .transition()\r\n          .duration(500)\r\n          .call(zoom.transform, d3.zoomIdentity);\r\n      });\r\n\r\n      return () => selection.on('.zoom', null);\r\n    }, [baseScale]);\r\n\r\n    Object.assign(window, { canvas: canvasRef.current, zoom, d3 });\r\n\r\n    const update = newEffect(() => effect.current());\r\n    return [zoomedScale, update] as [typeof zoomedScale, typeof update];\r\n  }\r\n);\r\n\r\nconst PlayPauseArgs = required<{\r\n  zoom: Zoom;\r\n  baseScale: d3.ScaleLinear<number, number>;\r\n  selection: d3.Selection<typeof GoodCanvasElement.propsOut, any, any, any>;\r\n  effect: REF<typeof noop>;\r\n}>();\r\n\r\nfunction playPause({\r\n  zoom,\r\n  baseScale,\r\n  selection,\r\n  effect,\r\n}: typeof PlayPauseArgs.propsOut) {\r\n  let start = fromJS({ clientX: 0, clientY: 0 }) as ImmMapType;\r\n  let lastClicked = Date.now();\r\n  let playing = true;\r\n\r\n  let at = Date.now();\r\n  const moonWalk = () => {\r\n    const delta = Date.now() - at;\r\n    at += delta;\r\n    const dx = delta * slope(baseScale);\r\n    if (isFinite(dx)) {\r\n      zoom.translateBy(selection, dx, 0);\r\n    }\r\n    Object.assign(window, { at, lastClicked, effect: effect.current });\r\n  };\r\n\r\n  function onStart() {\r\n    const e = d3.event;\r\n    if (\r\n      !(\r\n        e.sourceEvent instanceof MouseEvent ||\r\n        e.sourceEvent instanceof TouchEvent\r\n      )\r\n    )\r\n      return;\r\n\r\n    const position = {\r\n      clientX: e.sourceEvent.clientX,\r\n      clientY: e.sourceEvent.clientY,\r\n    };\r\n    start = withImm._mergeDeep(start, position);\r\n  }\r\n\r\n  function onEnd() {\r\n    const e = d3.event;\r\n    if (\r\n      !(\r\n        e.sourceEvent instanceof MouseEvent ||\r\n        e.sourceEvent instanceof TouchEvent\r\n      )\r\n    )\r\n      return;\r\n\r\n    const position = {\r\n      clientX: e.sourceEvent.clientX,\r\n      clientY: e.sourceEvent.clientY,\r\n    };\r\n    const current = withImm._mergeDeep(start, position);\r\n\r\n    // Is it a click and not a drag?\r\n    if (current === start) {\r\n      const delta = Date.now() - lastClicked;\r\n      lastClicked += delta;\r\n\r\n      if (delta < 250) {\r\n        playing = true;\r\n        effect.current = noop;\r\n        selection.dispatch('dblclick.zoom');\r\n      } else if (playing) {\r\n        playing = false;\r\n        at = lastClicked;\r\n        effect.current = moonWalk;\r\n      } else {\r\n        playing = true;\r\n        effect.current = noop;\r\n      }\r\n    }\r\n  }\r\n\r\n  return { onStart, onEnd };\r\n}\r\n","import { newEffect } from 'utils/canvas';\r\nimport { defaults } from 'utils/DefaultProps';\r\n\r\nexport const Args = defaults({\r\n  spread: 0,\r\n  blur: 1,\r\n  offsetX: 0,\r\n  offsetY: 0,\r\n  color: 'inherit',\r\n});\r\n\r\nexport const useGlow = Args.wrap(\r\n  ({ spread, blur, offsetX, offsetY, color }) => {\r\n    return newEffect(\r\n      ctx => {\r\n        const { lineWidth = 0 } = ctx;\r\n        const existing = ctx.filter === 'none' ? '' : ctx.filter + ' ';\r\n        ctx.filter = existing + `blur(${blur}px)`;\r\n        ctx.translate(offsetX, offsetY);\r\n        ctx.lineWidth += lineWidth + 2 * spread;\r\n        if (color !== 'inherit') {\r\n          ctx.fillStyle = color;\r\n          ctx.strokeStyle = color;\r\n        }\r\n      },\r\n      { injection: true }\r\n    );\r\n  }\r\n);\r\n","import { GoodCanvasChild } from 'components/GoodCanvas';\r\nimport { usePoints } from 'components/usePoints';\r\nimport { useLine } from 'components/useLine';\r\nimport { useDataFeed } from './useDataFeed';\r\nimport { useView } from './useView';\r\nimport {\r\n  clear,\r\n  getContext,\r\n  CanvasEffect,\r\n  newEffect,\r\n  EffectOptions,\r\n} from 'utils/canvas';\r\nimport { useDash } from './useDash';\r\nimport { useFPS } from './useFPS';\r\nimport { useScalesXY } from './useScales';\r\nimport { useTimespan } from './useTimespan';\r\nimport { useAnimationFrame } from './useAnimationFrame';\r\nimport { useClip } from './useCrop';\r\nimport { useControls } from './useControls';\r\nimport { usePaddingSpring } from './usePaddingSpring';\r\nimport * as d3 from 'd3';\r\nimport { diff } from 'utils/diff';\r\nimport { Pair } from 'utils/Pair';\r\nimport clamp from 'utils/clamp';\r\nimport { useGlow } from 'components/Glow';\r\nimport { defaults, declare, required } from 'utils/DefaultProps';\r\nimport { REF } from 'utils/easier';\r\n\r\nexport const _IVPlot = GoodCanvasChild.wrap(props => {\r\n  const samplePeriod = 400;\r\n  const amps = useDataFeed({\r\n    samplePeriod: samplePeriod,\r\n    maxSize: 1000,\r\n  });\r\n  const volts = useDataFeed({\r\n    samplePeriod: samplePeriod,\r\n    maxSize: 1000,\r\n  });\r\n\r\n  const [scaleX, scaleY] = useScalesXY({\r\n    padding: { y: { height: 0.1 } },\r\n    ...props,\r\n  });\r\n  const [, scaleY2] = useScalesXY({\r\n    padding: { y: { height: 0.1 } },\r\n    ...props,\r\n  });\r\n\r\n  const timespan = useTimespan({\r\n    speed: 100,\r\n    ...props,\r\n  });\r\n\r\n  const baseScale = scaleX.copy().domain([-timespan, 0]);\r\n  const [zoomedScale, updateZoomedScale] = useControls({ baseScale, ...props });\r\n\r\n  const padding = usePaddingSpring({ by: 2 * samplePeriod });\r\n  const { view: ampsView, update: updateAmpsView } = useView({\r\n    scaleX: zoomedScale,\r\n    scaleY: scaleY,\r\n    buffer: amps,\r\n    padding,\r\n  });\r\n  const {\r\n    view: voltsView,\r\n    update: updateVoltsView,\r\n    scaleX: viewScale,\r\n  } = useView({\r\n    scaleX: zoomedScale,\r\n    scaleY: scaleY2,\r\n    buffer: volts,\r\n    padding,\r\n  });\r\n\r\n  const Args = declare(\r\n    required<{\r\n      viewScale: d3.ScaleLinear<number, number>;\r\n    }>(),\r\n    defaults({\r\n      style: {\r\n        fillStyle: '#888',\r\n        strokeStyle: '#444',\r\n        font: '14px ubuntu mono, monospace',\r\n      },\r\n    }),\r\n    EffectOptions\r\n  );\r\n\r\n  const useTicks = Args.wrap(({ viewScale, ...effectOptions }) => {\r\n    const scale = d3.scaleTime().range(baseScale.range());\r\n    const format = scale.tickFormat();\r\n\r\n    return newEffect(\r\n      ctx => {\r\n        scale.domain(viewScale.domain());\r\n        const span = diff(scale.domain() as Pair<Date>, x => x.getTime());\r\n        const every = clamp(span / timespan, [1]);\r\n        const ticks = scale.ticks(d3.timeSecond.every(every)!);\r\n        const gap = diff(ticks.slice(0, 2) as Pair<Date>, scale);\r\n        const pad = clamp(0.05 * gap, [1]);\r\n\r\n        for (const tick of ticks) {\r\n          const t = scale(tick);\r\n          ctx.beginPath();\r\n          ctx.moveTo(t, 0);\r\n          ctx.lineTo(t, ctx.height);\r\n          ctx.stroke();\r\n          ctx.fillText(format(tick), t + pad, ctx.height - pad);\r\n        }\r\n      },\r\n      { ...effectOptions }\r\n    );\r\n  });\r\n\r\n  const LabelsArgs = declare(\r\n    required<{ data: REF<Pair[]>; scaleY: d3.ScaleLinear<number, number> }>(),\r\n    defaults({ style: { font: '14px ubuntu mono, monospace' } })\r\n  );\r\n\r\n  const useLabels = LabelsArgs.wrap(({ data, scaleY, ...effectOptions }) => {\r\n    const format = (x: number) => x.toFixed(1); //d3.format('.1f');\r\n    return newEffect(\r\n      ctx => {\r\n        const pad = clamp(0.01 * ctx.height, [1]);\r\n        for (const [x, y] of data.current) {\r\n          ctx.fillText(format(scaleY.invert(y)), x + pad, y - pad);\r\n        }\r\n      },\r\n      { ...effectOptions }\r\n    );\r\n  });\r\n\r\n  const dashed = useDash({ segments: [4, 6], period: 1000 });\r\n  const inside = useClip({ by: { height: 0.1 } });\r\n  const outside = useClip({ by: { height: 0.1 }, invert: true });\r\n  const glow1 = useGlow({\r\n    spread: 0.5,\r\n    blur: 10,\r\n    color: 'hsl(330, 100%, 50%)',\r\n  });\r\n  const glow2 = useGlow({\r\n    spread: 0.5,\r\n    blur: 10,\r\n    color: 'hsl(210, 100%, 50%)',\r\n  });\r\n  const line = useLine({\r\n    data: ampsView,\r\n    style: { strokeStyle: 'hsl(330, 100%, 67%)' },\r\n  });\r\n  const glowLine = useLine({\r\n    data: ampsView,\r\n    style: { strokeStyle: 'hsl(330, 100%, 67%)' },\r\n    injectEffect: glow1,\r\n  });\r\n  const points = usePoints({ data: ampsView });\r\n  const line2 = useLine({\r\n    data: voltsView,\r\n    style: { strokeStyle: 'hsl(210, 100%, 67%)' },\r\n  });\r\n  const glowLine2 = useLine({\r\n    data: voltsView,\r\n    style: { strokeStyle: 'hsl(210, 100%, 67%)' },\r\n    injectEffect: glow2,\r\n  });\r\n  const points2 = usePoints({\r\n    data: voltsView,\r\n    style: {\r\n      fillStyle: 'hsl(210, 100%, 75%)',\r\n      strokeStyle: 'hsl(210, 100%, 50%)',\r\n    },\r\n  });\r\n\r\n  const animations: CanvasEffect[] = [\r\n    updateZoomedScale,\r\n    updateAmpsView,\r\n    updateVoltsView,\r\n    clear,\r\n    useTicks({ viewScale }),\r\n    outside(dashed(line), dashed(line2)),\r\n    inside(\r\n      glowLine,\r\n      line,\r\n      points(useLabels({ data: ampsView, scaleY })),\r\n      glowLine2,\r\n      line2,\r\n      points2(useLabels({ data: voltsView, scaleY: scaleY2 }))\r\n    ),\r\n    useFPS({\r\n      offset: { x: { height: -0.1 }, y: { height: -0.9 } },\r\n      style: { fillStyle: 'hsl(90, 75%, 50%)' },\r\n    }),\r\n  ];\r\n\r\n  let n = 0;\r\n  useAnimationFrame(\r\n    () => {\r\n      const { ctx } = getContext(props.canvasRef);\r\n      animations.forEach(e => e(ctx));\r\n      // console.log('frame:', ++n);\r\n    }\r\n    // ,{ interval: 500 }\r\n  );\r\n\r\n  return null;\r\n});\r\n","import { useSpring } from 'react-spring';\r\nimport { useRef } from 'react';\r\n\r\nexport function usePaddingSpring<T extends { by: number }>(springProps: T) {\r\n  const immediate = useRef(0);\r\n  const [{ by }, update] = useSpring(() => ({\r\n    ...springProps,\r\n  }));\r\n  return {\r\n    by,\r\n    update,\r\n    immediate,\r\n  };\r\n}\r\n","import React from 'react';\r\nimport GoodCanvas from 'components/GoodCanvas';\r\nimport { StyleProp } from 'utils/BaseProps';\r\nimport { _IVPlot } from './_IVPlot';\r\nimport { declare, defaults } from 'utils/DefaultProps';\r\nimport { FC } from 'utils/easier';\r\n\r\n/* interface ModeType {\r\n  style: React.CSSProperties | {};\r\n  current: {\r\n    line: {\r\n      canvasStyle?: CanvasRenderingContext2D | {};\r\n    };\r\n    points: {\r\n      canvasStyle?: CanvasRenderingContext2D | {};\r\n    };\r\n  };\r\n}\r\n\r\nexport const lightMode: ModeType = {\r\n  style: { backgroundColor: 'transparent' },\r\n  current: {\r\n    line: {\r\n      canvasStyle: { strokeStyle: 'hsl(330, 100%, 75%)' },\r\n      // glow: { blurRadius: 10, color: 'hsl(330, 100%, 50%)' },\r\n    },\r\n    points: {\r\n      canvasStyle: { strokeStyle: 'hsl(330, 100%, 75%)' },\r\n      // glow: { blurRadius: 10, color: 'hsl(330, 100%, 50%)' },\r\n    },\r\n  },\r\n}; */\r\n\r\nexport const Props = declare(\r\n  defaults({\r\n    style: {\r\n      width: '100%',\r\n      height: '150px',\r\n      borderRadius: '5px',\r\n      // border: '10px solid blue',\r\n      backgroundColor: 'black',\r\n    },\r\n  }),\r\n  StyleProp\r\n);\r\n\r\nconst IVPlot: FC<typeof Props.propsOut> = props => {\r\n  // unpack props\r\n  const { style } = props;\r\n\r\n  return (\r\n    <GoodCanvas style={style}>\r\n      <_IVPlot />\r\n    </GoodCanvas>\r\n  );\r\n};\r\n\r\nexport default Props.wrap(IVPlot);\r\n\r\n/* \r\n// canvasStyle={lightMode.current.line.canvasStyle}\r\n      // glow={lightMode.current.line.glow}\r\n*/\r\n// blur={{ radius: 10 }}\r\n// canvasStyle={lightMode.current.points.canvasStyle}\r\n// glow={lightMode.current.points.glow}\r\n","import React, { Component } from 'react';\r\nimport logo from './logo.svg';\r\nimport './App.css';\r\nimport IVPlot from 'components/IVPlot';\r\n\r\nclass App extends Component<{}, { bleh: number }> {\r\n  render() {\r\n    // return 'blehehehehehe';\r\n    return (\r\n      <div style={{ padding: '1vw' }}>\r\n        <IVPlot />\r\n        <br />\r\n        <IVPlot />\r\n        <br />\r\n        <IVPlot />\r\n      </div>\r\n    );\r\n    // return (\r\n    //   <div className='App'>\r\n    //     <header className='App-header'>\r\n    //       <img src={logo} className='App-logo' alt='logo' />\r\n    //       <p>\r\n    //         Edit <code>src/App.js</code> and save to reload.\r\n    //       </p>\r\n    //       <a\r\n    //         className='App-link'\r\n    //         href='https://reactjs.org'\r\n    //         target='_blank'\r\n    //         rel='noopener noreferrer'\r\n    //       >\r\n    //         Learn React\r\n    //       </a>\r\n    //     </header>\r\n    //   </div>\r\n    // );\r\n  }\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read http://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: http://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}